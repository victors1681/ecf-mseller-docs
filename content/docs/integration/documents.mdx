---
title: Env√≠o y Consulta de Documentos
description: C√≥mo enviar y consultar documentos electr√≥nicos en MSeller ECF
---

# Env√≠o y Consulta de Documentos

Esta secci√≥n explica c√≥mo enviar y consultar documentos electr√≥nicos utilizando la API de MSeller ECF.

## Env√≠o de documentos

Para enviar un documento electr√≥nico a la plataforma, debes realizar una solicitud POST al endpoint correspondiente:

```
POST /{entorno}/documentos-ecf
```

Donde `{entorno}` puede ser:

- `TesteCF` (para pruebas)
- `CerteCF` (para certificaci√≥n)
- `eCF` (para producci√≥n)

### Par√°metro de validaci√≥n

Puedes agregar el par√°metro `validate=true` al endpoint para validar el documento antes de enviarlo a la DGII:

```
POST /{entorno}/documentos-ecf?validate=true
```

> **‚ö†Ô∏è IMPORTANTE - Feature en fase de pruebas**: Esta opci√≥n est√° **activada por defecto** hasta completar la fase de depuraci√≥n y pruebas. Durante este per√≠odo, todos los documentos ser√°n validados autom√°ticamente antes de su env√≠o. Una vez estabilizado el feature, esta validaci√≥n ser√° opcional y controlada expl√≠citamente mediante el par√°metro `validate=true`.

Cuando este par√°metro est√° presente, MSeller ECF realiza una **validaci√≥n completa del documento** verificando que cumpla con todos los requisitos y par√°metros necesarios antes de procesarlo y enviarlo a la DGII:

- ‚úÖ **Detecta errores de formato** antes de registrar el documento
- ‚úÖ **Verifica c√°lculos y totales** seg√∫n las especificaciones de la DGII
- ‚úÖ **Valida campos requeridos** y sus valores permitidos
- ‚úÖ **Comprueba la estructura del documento** contra los esquemas XSD oficiales
- ‚úÖ **Ahorra secuencias de e-NCF** al evitar env√≠os con errores
- ‚úÖ **Debugging eficiente** con mensajes de error detallados antes del env√≠o oficial

**Respuesta de validaci√≥n exitosa:**

Si el documento pasa todas las validaciones, recibir√°s una respuesta indicando que el documento es v√°lido:

```json
{
  "valid": true,
  "message": "El documento ha sido validado correctamente y cumple con todos los requisitos de la DGII"
}
```

**Respuesta de validaci√≥n con errores:**

Si se encuentran errores, recibir√°s un detalle de los problemas encontrados:

```json
{
  "message": "‚ùå 2 error(s):\n1. [TIPO_ECF_MISMATCH] ECF.Encabezado.IdDoc.TipoeCF: TipoeCF (322) no coincide con el c√≥digo de tipo del eNCF (32) | Details: {\"expected\":32,\"received\":322,\"encf\":\"E320000000002\"}\n2. [TIPO_ECF_INVALID_LENGTH] ECF.Encabezado.IdDoc.TipoeCF: TipoeCF debe tener 2 d√≠gitos | Details: {\"expected\":2,\"received\":3,\"value\":\"322\"}",
  "code": "ECF_VALIDATION_FAILED",
  "requestId": "fdc9a42b-fbf6-41c4-9985-1c27e312197a",
  "details": {
    "validationErrors": [
      {
        "code": "TIPO_ECF_MISMATCH",
        "field": "ECF.Encabezado.IdDoc.TipoeCF",
        "details": {
          "expected": 32,
          "received": 322,
          "encf": "E320000000002"
        },
        "name": "EcfValidationError"
      },
      {
        "code": "TIPO_ECF_INVALID_LENGTH",
        "field": "ECF.Encabezado.IdDoc.TipoeCF",
        "details": {
          "expected": 2,
          "received": 3,
          "value": "322"
        },
        "name": "EcfValidationError"
      }
    ]
  }
}
```

**Campos de la respuesta de error:**

| Campo                      | Descripci√≥n                                                                     |
| -------------------------- | ------------------------------------------------------------------------------- |
| message                    | Mensaje legible con el resumen de todos los errores encontrados                 |
| code                       | C√≥digo de error general (`ECF_VALIDATION_FAILED`)                               |
| requestId                  | ID √∫nico de la solicitud para seguimiento y debugging                           |
| details.validationErrors   | Array con los errores de validaci√≥n detallados                                  |
| validationErrors[].code    | C√≥digo espec√≠fico del error (ej: `TIPO_ECF_MISMATCH`)                           |
| validationErrors[].field   | Ruta completa al campo con error (ej: `ECF.Encabezado.IdDoc.TipoeCF`)           |
| validationErrors[].details | Objeto con informaci√≥n adicional del error (valores esperados, recibidos, etc.) |
| validationErrors[].name    | Nombre del tipo de error (`EcfValidationError`)                                 |

> **üí° Recomendaci√≥n**: Usa `validate=true` durante el desarrollo y pruebas para asegurar que tus documentos cumplan con todos los requisitos antes de enviarlos oficialmente a la DGII.

> **‚ö†Ô∏è Nota importante**: Cuando usas `validate=true`, el documento **NO se env√≠a a la DGII** y **NO se consume una secuencia de e-NCF**. Solo se realiza la validaci√≥n del formato y contenido.

### Encabezados requeridos

```
Authorization: Bearer {tu_token}
X-API-KEY: {tu_api_key}
Content-Type: application/json
```

### Cuerpo de la solicitud

El cuerpo de la solicitud debe contener el documento en formato JSON estructurado seg√∫n las especificaciones detalladas en [Formato de Documentos](/docs/integration/document-format).

### Ejemplos de documentos JSON

#### Ejemplo 1: Factura de Cr√©dito Fiscal con descuento simple

```json
{
  "ECF": {
    "Encabezado": {
      "Version": "1.0",
      "IdDoc": {
        "TipoeCF": "31",
        "eNCF": "E310571508136",
        "FechaVencimientoSecuencia": "31-12-2026",
        "IndicadorEnvioDiferido": "1",
        "IndicadorMontoGravado": "0",
        "TipoIngresos": "05",
        "TipoPago": "2",
        "FechaLimitePago": "07-08-2026",
        "TotalPaginas": 1
      },
      "Emisor": {
        "RNCEmisor": "102320705",
        "RazonSocialEmisor": "Comercial Ejemplo SRL",
        "DireccionEmisor": "Calle Principal No. 123",
        "FechaEmision": "29-06-2025"
      },
      "Comprador": {
        "RNCComprador": "101023122",
        "RazonSocialComprador": "Cliente Prueba SRL"
      },
      "Totales": {
        "MontoGravadoTotal": 540.0,
        "MontoGravadoI1": 540.0,
        "MontoExento": 0,
        "ITBIS1": 18,
        "TotalITBIS": 97.2,
        "TotalITBIS1": 97.2,
        "MontoTotal": 637.2,
        "MontoNoFacturable": 0
      }
    },
    "DetallesItems": {
      "Item": [
        {
          "NumeroLinea": "1",
          "IndicadorFacturacion": "1",
          "NombreItem": "Producto Ejemplo",
          "IndicadorBienoServicio": "1",
          "CantidadItem": 24,
          "UnidadMedida": "43",
          "PrecioUnitarioItem": 25.0,
          "DescuentoMonto": 60.0,
          "TablaSubDescuento": {
            "SubDescuento": [
              {
                "TipoSubDescuento": "%",
                "SubDescuentoPorcentaje": 10.0,
                "MontoSubDescuento": 60.0
              }
            ]
          },
          "MontoItem": 540.0
        }
      ]
    },
    "Paginacion": {
      "Pagina": [
        {
          "PaginaNo": 1,
          "NoLineaDesde": 1,
          "NoLineaHasta": 1,
          "SubtotalMontoGravadoPagina": 540.0,
          "SubtotalMontoGravado1Pagina": 540.0,
          "SubtotalExentoPagina": 0,
          "SubtotalItbisPagina": 97.2,
          "SubtotalItbis1Pagina": 97.2,
          "MontoSubtotalPagina": 637.2,
          "SubtotalMontoNoFacturablePagina": 0
        }
      ]
    },
    "FechaHoraFirma": ""
  }
}
```

#### Ejemplo 2: Factura de Consumo con m√∫ltiples ITBIS y producto exento

Este ejemplo muestra una factura de consumo (tipo 32) con m√∫ltiples productos que incluyen diferentes tasas de ITBIS (18% y 16%) y un producto exento de impuestos.

```json
{
  "ECF": {
    "Encabezado": {
      "Version": "1.0",
      "IdDoc": {
        "TipoeCF": 32,
        "eNCF": "E320004380890",
        "IndicadorEnvioDiferido": 1,
        "IndicadorMontoGravado": 0,
        "TipoIngresos": "01",
        "TipoPago": 1
      },
      "Emisor": {
        "RNCEmisor": "000000000",
        "RazonSocialEmisor": "Empresa Ejemplo SRL",
        "NombreComercial": "Tienda Ejemplo",
        "Sucursal": "SUCURSAL PRINCIPAL",
        "DireccionEmisor": "Calle Principal #100",
        "Municipio": "010100",
        "Provincia": "010000",
        "WebSite": "www.ejemplo.com.do",
        "CodigoVendedor": "VEND001",
        "FechaEmision": "04-11-2025"
      },
      "Comprador": {
        "RNCComprador": "40211111111",
        "RazonSocialComprador": "Juan P√©rez",
        "DireccionComprador": "C/ Ejemplo #123",
        "FechaEntrega": "04-11-2025"
      },
      "Totales": {
        "MontoGravadoTotal": 1139.5,
        "MontoGravadoI1": 807.02,
        "MontoGravadoI2": 332.48,
        "MontoExento": 96,
        "ITBIS1": 18,
        "ITBIS2": 16,
        "TotalITBIS": 194.11,
        "TotalITBIS1": 140.91,
        "TotalITBIS2": 53.2,
        "MontoTotal": 1405.39,
        "MontoNoFacturable": 0
      }
    },
    "DetallesItems": {
      "Item": [
        {
          "NumeroLinea": 1,
          "IndicadorFacturacion": 4,
          "NombreItem": "AGUA FONTINA",
          "IndicadorBienoServicio": 1,
          "DescripcionItem": "AGUA FONTINA",
          "CantidadItem": 1,
          "UnidadMedida": 43,
          "PrecioUnitarioItem": 96,
          "MontoItem": 96
        },
        {
          "NumeroLinea": 2,
          "IndicadorFacturacion": 1,
          "NombreItem": "MALTA INDIA 12/1",
          "IndicadorBienoServicio": 1,
          "DescripcionItem": "MALTA INDIA 12/1",
          "CantidadItem": 1,
          "UnidadMedida": 43,
          "PrecioUnitarioItem": 807.02,
          "DescuentoMonto": 24.21,
          "TablaSubDescuento": {
            "SubDescuento": [
              {
                "TipoSubDescuento": "%",
                "SubDescuentoPorcentaje": 3,
                "MontoSubDescuento": 24.21
              }
            ]
          },
          "MontoItem": 807.02
        },
        {
          "NumeroLinea": 3,
          "IndicadorFacturacion": 2,
          "NombreItem": "CAFE BUSTELO CAPSULA 1.7 OZ.",
          "IndicadorBienoServicio": 1,
          "DescripcionItem": "CAFE BUSTELO CAPSULA 1.7 OZ.",
          "CantidadItem": 1,
          "UnidadMedida": 43,
          "PrecioUnitarioItem": 332.48,
          "MontoItem": 332.48
        }
      ]
    },
    "FechaHoraFirma": "03-11-2025 19:26:35"
  }
}
```

**Caracter√≠sticas destacadas de este ejemplo:**

- **Producto exento** (Item 1): El agua tiene `IndicadorFacturacion: 4` que indica que est√° exenta de ITBIS
- **M√∫ltiples tasas de ITBIS**: Item 2 con ITBIS1 (18%) e Item 3 con ITBIS2 (16%)
- **Descuento aplicado**: El Item 2 incluye un descuento del 3%
- **Factura de consumo**: `TipoeCF: 32` para ventas al consumidor final
- **Informaci√≥n completa del emisor**: Incluye sucursal, municipio, provincia y c√≥digo de vendedor

> **Nota importante**: Para facturas de consumo (tipo 32), puedes omitir el RNC del comprador si es una venta a persona f√≠sica sin RNC, pero es recomendable incluirlo cuando est√© disponible.

### Ejemplo de validaci√≥n de documento

Antes de enviar un documento oficialmente, puedes validarlo usando el par√°metro `validate=true`:

<Tabs items={["cURL", "JavaScript", "C#", "PHP"]}>
<TabsContent value="cURL">

```bash
curl -X POST \
  'https://ecf.api.mseller.app/TesteCF/documentos-ecf?validate=true' \
  -H 'Authorization: Bearer eyJraWQiOiJ1dE...' \
  -H 'X-API-KEY: tu_api_key' \
  -H 'Content-Type: application/json' \
  -d '{
    "ECF": {
      "Encabezado": {
        "Version": "1.0",
        "IdDoc": {
          "TipoeCF": "31",
          "eNCF": "E310571508136"
        },
        "Emisor": {
          "RNCEmisor": "102320705",
          "RazonSocialEmisor": "Comercial Ejemplo SRL"
        }
      }
    }
  }'
```

</TabsContent>

<TabsContent value="JavaScript">

```javascript
async function validarDocumento(documento) {
  const idToken = localStorage.getItem("idToken");

  try {
    const response = await fetch(
      "https://ecf.api.mseller.app/TesteCF/documentos-ecf?validate=true",
      {
        method: "POST",
        headers: {
          Authorization: `Bearer ${idToken}`,
          "X-API-KEY": "tu_api_key",
          "Content-Type": "application/json",
        },
        body: JSON.stringify(documento),
      }
    );

    const resultado = await response.json();

    // Verificar si la validaci√≥n fue exitosa
    if (response.ok && resultado.valid) {
      console.log("‚úì Documento v√°lido, listo para enviar");
      // Ahora puedes enviarlo sin el par√°metro validate
      return enviarDocumento(documento);
    } else if (resultado.code === "ECF_VALIDATION_FAILED") {
      console.error("‚úó Errores de validaci√≥n encontrados:");
      console.error(`Request ID: ${resultado.requestId}`);
      console.error(resultado.message);

      // Mostrar detalles de cada error
      resultado.details.validationErrors.forEach((error, index) => {
        console.error(`\nError ${index + 1}:`);
        console.error(`  Campo: ${error.field}`);
        console.error(`  C√≥digo: ${error.code}`);
        console.error(`  Detalles:`, error.details);
      });

      return resultado;
    } else {
      console.error("‚úó Error inesperado:", resultado);
      return resultado;
    }
  } catch (error) {
    console.error("Error al validar documento:", error);
    throw error;
  }
}
```

</TabsContent>

<TabsContent value="C#">

```csharp
using System;
using System.Net.Http;
using System.Text;
using System.Threading.Tasks;
using Newtonsoft.Json.Linq;

public class MSellercfClient
{
    private readonly HttpClient _client = new HttpClient();
    private readonly string _idToken;
    private readonly string _apiKey;

    public MSellercfClient(string idToken, string apiKey)
    {
        _idToken = idToken;
        _apiKey = apiKey;
    }

    public async Task<JObject> ValidarDocumento(JObject documento)
    {
        _client.DefaultRequestHeaders.Clear();
        _client.DefaultRequestHeaders.Add("Authorization", $"Bearer {_idToken}");
        _client.DefaultRequestHeaders.Add("X-API-KEY", _apiKey);

        var content = new StringContent(
            documento.ToString(),
            Encoding.UTF8,
            "application/json");

        var response = await _client.PostAsync(
            "https://ecf.api.mseller.app/TesteCF/documentos-ecf?validate=true",
            content);

        var responseJson = await response.Content.ReadAsStringAsync();
        var resultado = JObject.Parse(responseJson);

        // Verificar si la validaci√≥n fue exitosa
        if (response.IsSuccessStatusCode && resultado["valid"]?.ToObject<bool>() == true)
        {
            Console.WriteLine("‚úì Documento v√°lido, listo para enviar");
            // Ahora puedes enviarlo sin el par√°metro validate
            return await EnviarDocumento(documento);
        }
        else if (resultado["code"]?.ToString() == "ECF_VALIDATION_FAILED")
        {
            Console.WriteLine("‚úó Errores de validaci√≥n encontrados:");
            Console.WriteLine($"Request ID: {resultado["requestId"]}");
            Console.WriteLine(resultado["message"]);

            // Mostrar detalles de cada error
            var errors = resultado["details"]?["validationErrors"];
            if (errors != null)
            {
                for (int i = 0; i < errors.Count(); i++)
                {
                    var error = errors[i];
                    Console.WriteLine($"\nError {i + 1}:");
                    Console.WriteLine($"  Campo: {error["field"]}");
                    Console.WriteLine($"  C√≥digo: {error["code"]}");
                    Console.WriteLine($"  Detalles: {error["details"]}");
                }
            }

            return resultado;
        }
        else
        {
            Console.WriteLine("‚úó Error inesperado:");
            Console.WriteLine(resultado);
            return resultado;
        }
    }
}
```

</TabsContent>

<TabsContent value="PHP">

```php
<?php
function validarDocumento($documento, $idToken, $apiKey) {
    $url = 'https://ecf.api.mseller.app/TesteCF/documentos-ecf?validate=true';

    $options = [
        'http' => [
            'method' => 'POST',
            'header' =>
                "Authorization: Bearer " . $idToken . "\r\n" .
                "X-API-KEY: " . $apiKey . "\r\n" .
                "Content-Type: application/json\r\n",
            'content' => json_encode($documento)
        ]
    ];

    $context = stream_context_create($options);
    $result = file_get_contents($url, false, $context);

    if ($result === false) {
        throw new Exception('Error al validar documento');
    }

    $resultado = json_decode($result, true);

    // Verificar si la validaci√≥n fue exitosa
    if (isset($resultado['valid']) && $resultado['valid'] === true) {
        echo "‚úì Documento v√°lido, listo para enviar\n";
        // Ahora puedes enviarlo sin el par√°metro validate
        return enviarDocumento($documento, $idToken, $apiKey);
    } else if (isset($resultado['code']) && $resultado['code'] === 'ECF_VALIDATION_FAILED') {
        echo "‚úó Errores de validaci√≥n encontrados:\n";
        echo "Request ID: " . $resultado['requestId'] . "\n";
        echo $resultado['message'] . "\n";

        // Mostrar detalles de cada error
        if (isset($resultado['details']['validationErrors'])) {
            foreach ($resultado['details']['validationErrors'] as $index => $error) {
                echo "\nError " . ($index + 1) . ":\n";
                echo "  Campo: " . $error['field'] . "\n";
                echo "  C√≥digo: " . $error['code'] . "\n";
                echo "  Detalles: " . json_encode($error['details']) . "\n";
            }
        }

        return $resultado;
    } else {
        echo "‚úó Error inesperado:\n";
        print_r($resultado);
        return $resultado;
    }
}

// Uso
$idToken = $_SESSION['idToken'];
$apiKey = 'tu_api_key';
$resultado = validarDocumento($documento, $idToken, $apiKey);
?>
```

</TabsContent>
</Tabs>

### Ejemplo de env√≠o

<Tabs items={["cURL", "JavaScript", "C#", "PHP"]}>
<TabsContent value="cURL">
 
```bash
curl -X POST \
  https://ecf.api.mseller.app/TesteCF/documentos-ecf \
  -H 'Authorization: Bearer eyJraWQiOiJ1dE...' \
  -H 'X-API-KEY: tu_api_key' \
  -H 'Content-Type: application/json' \
  -d '{
    "ECF": {
      "Encabezado": {
        "Version": "1.0",
        "IdDoc": {
          "TipoeCF": "31",
          "eNCF": "E310571508136",
          "FechaVencimientoSecuencia": "31-12-2026",
          "IndicadorEnvioDiferido": "1",
          "IndicadorMontoGravado": "0",
          "TipoIngresos": "05",
          "TipoPago": "2",
          "FechaLimitePago": "07-08-2026",
          "TotalPaginas": 1
        },
        "Emisor": {
          "RNCEmisor": "Tu RNC",
          "RazonSocialEmisor": "Tu Negocio",
          "DireccionEmisor": "DireccionEmisor1",
          "FechaEmision": "29-06-2025"
        },
        "Comprador": {
          "RNCComprador": "101023122",
          "RazonSocialComprador": "Cliente Prueba SRL"
        },
        "Totales": {
          "MontoGravadoTotal": 540.0,
          "MontoGravadoI1": 540.0,
          "MontoExento": 0,
          "ITBIS1": 18,
          "TotalITBIS": 97.2,
          "TotalITBIS1": 97.2,
          "MontoTotal": 637.2,
          "MontoNoFacturable": 0
        }
      }
    }
  }'
```

</TabsContent>

<TabsContent value="JavaScript">
```javascript
async function enviarDocumento() {
  const documento = {
    ECF: {
      Encabezado: {
        Version: "1.0",
        IdDoc: {
          TipoeCF: "31",
          eNCF: "E310571508136",
          FechaVencimientoSecuencia: "31-12-2026",
          IndicadorEnvioDiferido: "1",
          IndicadorMontoGravado: "0",
          TipoIngresos: "05",
          TipoPago: "2",
          FechaLimitePago: "07-08-2026",
          TotalPaginas: 1,
        },
        Emisor: {
          RNCEmisor: "Tu RNC",
          RazonSocialEmisor: "Tu Negocio",
          DireccionEmisor: "DireccionEmisor1",
          FechaEmision: "29-06-2025",
        },
        Comprador: {
          RNCComprador: "101023122",
          RazonSocialComprador: "Cliente Prueba SRL",
        },
        Totales: {
          MontoGravadoTotal: 540.0,
          MontoGravadoI1: 540.0,
          MontoExento: 0,
          ITBIS1: 18,
          TotalITBIS: 97.2,
          TotalITBIS1: 97.2,
          MontoTotal: 637.2,
          MontoNoFacturable: 0,
        },
      },
      DetallesItems: {
        Item: [
          {
            NumeroLinea: "1",
            IndicadorFacturacion: "1",
            NombreItem: "Producto 1",
            IndicadorBienoServicio: "1",
            CantidadItem: 24,
            UnidadMedida: "43",
            PrecioUnitarioItem: 25.0,
            DescuentoMonto: 60.0,
            TablaSubDescuento: {
              SubDescuento: [
                {
                  TipoSubDescuento: "%",
                  SubDescuentoPorcentaje: 10.0,
                  MontoSubDescuento: 60.0,
                },
              ],
            },
            MontoItem: 540.0,
          },
        ],
      },
      Paginacion: {
        Pagina: [
          {
            PaginaNo: 1,
            NoLineaDesde: 1,
            NoLineaHasta: 1,
            SubtotalMontoGravadoPagina: 540.0,
            SubtotalMontoGravado1Pagina: 540.0,
            SubtotalExentoPagina: 0,
            SubtotalItbisPagina: 97.2,
            SubtotalItbis1Pagina: 97.2,
            MontoSubtotalPagina: 637.2,
            SubtotalMontoNoFacturablePagina: 0,
          },
        ],
      },
      FechaHoraFirma: "",
    },
  };

const idToken = localStorage.getItem("idToken");

try {
const response = await fetch(
"https://ecf.api.mseller.app/TesteCF/documentos-ecf",
{
method: "POST",
headers: {
Authorization: `Bearer ${idToken}`,
"X-API-KEY": "tu_api_key",
"Content-Type": "application/json",
},
body: JSON.stringify(documento),
}
);

    const resultado = await response.json();
    console.log("Documento enviado:", resultado);
    return resultado;

} catch (error) {
console.error("Error al enviar documento:", error);
throw error;
}
}

````

</TabsContent>

<TabsContent value="C#">
```csharp
using System;
using System.Net.Http;
using System.Text;
using System.Threading.Tasks;
using Newtonsoft.Json;
using Newtonsoft.Json.Linq;

public class MSellercfClient
{
    private readonly HttpClient _client = new HttpClient();
    private readonly string _idToken;
    private readonly string _apiKey;

    public MSellercfClient(string idToken, string apiKey)
    {
        _idToken = idToken;
        _apiKey = apiKey;
    }

    public async Task<JObject> EnviarDocumento()
    {
        // Crear el objeto documento
        var documento = new JObject();
        var ecf = new JObject();

        var encabezado = new JObject();
        encabezado["Version"] = "1.0";

        var idDoc = new JObject();
        idDoc["TipoeCF"] = "31";
        idDoc["eNCF"] = "E310571508136";
        idDoc["FechaVencimientoSecuencia"] = "31-12-2026";
        idDoc["IndicadorEnvioDiferido"] = "1";
        idDoc["IndicadorMontoGravado"] = "0";
        idDoc["TipoIngresos"] = "05";
        idDoc["TipoPago"] = "2";
        idDoc["FechaLimitePago"] = "07-08-2026";
        idDoc["TotalPaginas"] = 1;

        var emisor = new JObject();
        emisor["RNCEmisor"] = "Tu RNC";
        emisor["RazonSocialEmisor"] = "Tu Negocio";
        emisor["DireccionEmisor"] = "DireccionEmisor1";
        emisor["FechaEmision"] = "29-06-2025";

        var comprador = new JObject();
        comprador["RNCComprador"] = "101023122";
        comprador["RazonSocialComprador"] = "Cliente Prueba SRL";

        var totales = new JObject();
        totales["MontoGravadoTotal"] = 540.0;
        totales["MontoGravadoI1"] = 540.0;
        totales["MontoExento"] = 0;
        totales["ITBIS1"] = 18;
        totales["TotalITBIS"] = 97.2;
        totales["TotalITBIS1"] = 97.2;
        totales["MontoTotal"] = 637.2;
        totales["MontoNoFacturable"] = 0;

        // Estructura completa del documento (ejemplo simplificado)
        encabezado["IdDoc"] = idDoc;
        encabezado["Emisor"] = emisor;
        encabezado["Comprador"] = comprador;
        encabezado["Totales"] = totales;

        // Agregar m√°s detalles conforme a la estructura completa
        // ...

        ecf["Encabezado"] = encabezado;
        documento["ECF"] = ecf;

        // Configurar la solicitud HTTP
        _client.DefaultRequestHeaders.Clear();
        _client.DefaultRequestHeaders.Add("Authorization", $"Bearer {_idToken}");
        _client.DefaultRequestHeaders.Add("X-API-KEY", _apiKey);

        var content = new StringContent(
            documento.ToString(),
            Encoding.UTF8,
            "application/json");

        var response = await _client.PostAsync(
            "https://ecf.api.mseller.app/TesteCF/documentos-ecf",
            content);

        var responseJson = await response.Content.ReadAsStringAsync();
        return JObject.Parse(responseJson);
    }
}
````

</TabsContent>

<TabsContent value="PHP">
```php
<?php
function enviarDocumento($idToken, $apiKey) {
    $url = 'https://ecf.api.mseller.app/TesteCF/documentos-ecf';

    // Documento en formato JSON
    $documento = [
        'ECF' => [
            'Encabezado' => [
                'Version' => '1.0',
                'IdDoc' => [
                    'TipoeCF' => '31',
                    'eNCF' => 'E310571508136',
                    'FechaVencimientoSecuencia' => '31-12-2026',
                    'IndicadorEnvioDiferido' => '1',
                    'IndicadorMontoGravado' => '0',
                    'TipoIngresos' => '05',
                    'TipoPago' => '2',
                    'FechaLimitePago' => '07-08-2026',
                    'TotalPaginas' => 1
                ],
                'Emisor' => [
                    'RNCEmisor' => 'Tu RNC',
                    'RazonSocialEmisor' => 'Tu Negocio',
                    'DireccionEmisor' => 'DireccionEmisor1',
                    'FechaEmision' => '29-06-2025'
                ],
                'Comprador' => [
                    'RNCComprador' => '101023122',
                    'RazonSocialComprador' => 'Cliente Prueba SRL'
                ],
                'Totales' => [
                    'MontoGravadoTotal' => 540.0,
                    'MontoGravadoI1' => 540.0,
                    'MontoExento' => 0,
                    'ITBIS1' => 18,
                    'TotalITBIS' => 97.2,
                    'TotalITBIS1' => 97.2,
                    'MontoTotal' => 637.2,
                    'MontoNoFacturable' => 0
                ]
            ],
            'DetallesItems' => [
                'Item' => [
                    [
                        'NumeroLinea' => '1',
                        'IndicadorFacturacion' => '1',
                        'NombreItem' => 'Producto 1',
                        'IndicadorBienoServicio' => '1',
                        'CantidadItem' => 24,
                        'UnidadMedida' => '43',
                        'PrecioUnitarioItem' => 25.0,
                        'DescuentoMonto' => 60.0,
                        'TablaSubDescuento' => [
                            'SubDescuento' => [
                                [
                                    'TipoSubDescuento' => '%',
                                    'SubDescuentoPorcentaje' => 10.0,
                                    'MontoSubDescuento' => 60.0
                                ]
                            ]
                        ],
                        'MontoItem' => 540.0
                    ]
                ]
            ]
            // Agregar Paginaci√≥n y otros elementos seg√∫n necesidad
        ]
    ];

    $options = [
        'http' => [
            'method' => 'POST',
            'header' =>
                "Authorization: Bearer " . $idToken . "\r\n" .
                "X-API-KEY: " . $apiKey . "\r\n" .
                "Content-Type: application/json\r\n",
            'content' => json_encode($documento)
        ]
    ];

    $context = stream_context_create($options);
    $result = file_get_contents($url, false, $context);

    if ($result === false) {
        // Manejar error
        return null;
    }

    return json_decode($result, true);

}

// Uso
$idToken = $_SESSION['idToken']; // Obtenido del proceso de autenticaci√≥n
$apiKey = 'tu_api_key';
$resultado = enviarDocumento($idToken, $apiKey);
print_r($resultado);
?>

````

</TabsContent>
</Tabs>

> **Nota:** En el ambiente de prueba debes buscar una secuencia aleatoria que no haya sido utilizada, debes tratar con diferentes secuencias

### Respuesta exitosa

```json
{
  "rnc": "102320705",
  "ecf": "E310000009175",
  "internalTrackId": "58f1bdd7-f4be-4a2e-a1e6-570c95b8d477",
  "securityCode": "fWCZCV",
  "qr_url": "https://ecf.dgii.gov.do/testecf/consultatimbre?rncemisor=102320705&RncComprador=101023122&encf=E310000009175&FechaEmision=14-05-2025&montototal=637.2&FechaFirma=14-05-2025%2002:57:33&codigoseguridad=fWCZCV",
  "signedDate": "14-05-2025 02:57:33"
}
````

## Consulta de documentos

Para consultar el estado de un documento enviado previamente, debes realizar una solicitud GET al endpoint de consulta:

```
GET /{entorno}/documentos-ecf?ecf={No. comprobante electr√≥nico}
```

### Encabezados requeridos

```
Authorization: Bearer {tu_token}
X-API-KEY: {tu_api_key}
```

<Tabs items={["cURL", "JavaScript", "C#", "PHP"]}>
<TabsContent value="cURL">
### Ejemplo de consulta

```bash
curl -X GET \
  https://ecf.api.mseller.app/TesteCF/documentos-ecf?ecf=E123456789 \
  -H 'Authorization: Bearer eyJraWQiOiJ1dE...' \
  -H 'X-API-KEY: tu_api_key'
```

</TabsContent>

<TabsContent value="JavaScript">
### Ejemplo de consulta

```javascript
async function consultarDocumento(ecf) {
  const idToken = localStorage.getItem("idToken");

  try {
    const response = await fetch(
      `https://ecf.api.mseller.app/TesteCF/documentos-ecf?ecf=${ecf}`,
      {
        method: "GET",
        headers: {
          Authorization: `Bearer ${idToken}`,
          "X-API-KEY": "tu_api_key",
        },
      }
    );

    const resultado = await response.json();
    console.log("Estado del documento:", resultado);
    return resultado;
  } catch (error) {
    console.error("Error al consultar documento:", error);
    throw error;
  }
}
```

</TabsContent>

<TabsContent value="C#">
### Ejemplo de consulta

```csharp
using System;
using System.Net.Http;
using System.Threading.Tasks;
using Newtonsoft.Json.Linq;

public class MSellercfClient
{
    private readonly HttpClient _client = new HttpClient();
    private readonly string _idToken;
    private readonly string _apiKey;

    public MSellercfClient(string idToken, string apiKey)
    {
        _idToken = idToken;
        _apiKey = apiKey;
    }

    public async Task<JObject> ConsultarDocumento(string ecf)
    {
        _client.DefaultRequestHeaders.Clear();
        _client.DefaultRequestHeaders.Add("Authorization", $"Bearer {_idToken}");
        _client.DefaultRequestHeaders.Add("X-API-KEY", _apiKey);

        var response = await _client.GetAsync(
            $"https://ecf.api.mseller.app/TesteCF/documentos-ecf?ecf={ecf}");

        var responseJson = await response.Content.ReadAsStringAsync();
        return JObject.Parse(responseJson);
    }
}
```

</TabsContent>

<TabsContent value="PHP">
### Ejemplo de consulta

```php
<?php
function consultarDocumento($ecf, $idToken, $apiKey) {
    $url = 'https://ecf.api.mseller.app/TesteCF/documentos-ecf?ecf=' . urlencode($ecf);

    $options = [
        'http' => [
            'method' => 'GET',
            'header' =>
                "Authorization: Bearer " . $idToken . "\r\n" .
                "X-API-KEY: " . $apiKey . "\r\n"
        ]
    ];

    $context = stream_context_create($options);
    $result = file_get_contents($url, false, $context);

    if ($result === false) {
        // Manejar error
        return null;
    }

    return json_decode($result, true);
}

// Uso
$idToken = $_SESSION['idToken']; // Obtenido del proceso de autenticaci√≥n
$apiKey = 'tu_api_key';
$ecf = 'E123456789';
$resultado = consultarDocumento($ecf, $idToken, $apiKey);
print_r($resultado);
?>
```

</TabsContent>
</Tabs>

### Respuesta exitosa

```json
{
  "fileName": "102320705E310000009179.xml",
  "updateAt": 1747250783965,
  "customerReceivedAt": "14-05-2025 15:26:21",
  "documentType": "Factura de Cr√©dito Fiscal Electr√≥nico",
  "customerResponse": "{\"_declaration\":{\"_attributes\":{\"version\":\"1.0\",\"encoding\":\"utf-8\"}},\"ARECF\":{...}}",
  "status": "Aceptado",
  "dgiiResponse": [
    "{\"trackId\":\"0cc42712-4a99-48be-b66d-346b33e36d7f\",\"error\":null,\"mensaje\":null}",
    "{\"trackId\":\"0cc42712-4a99-48be-b66d-346b33e36d7f\",\"codigo\":\"1\",\"estado\":\"Aceptado\",\"rnc\":\"102320705\",\"encf\":\"E310000009179\",\"secuenciaUtilizada\":true,\"fechaRecepcion\":\"5/14/2025 3:26:21 PM\",\"mensajes\":[{\"valor\":\"\",\"codigo\":0}]}"
  ],
  "createdAt": 1747250778433,
  "securityCode": "hhABiM",
  "signedXml": "102320705/documents/TesteCF/102320705E310000009179.xml",
  "ncf": "E310000009179",
  "internalTrackId": "a118ea44-ac12-466a-b071-c4b650bb5a4f",
  "customerReceived": "0",
  "qr_url": "https://ecf.dgii.gov.do/testecf/consultatimbre?rncemisor=102320705&RncComprador=101023122&encf=E310000009179&FechaEmision=14-05-2025&montototal=637.2&FechaFirma=14-05-2025%2003:26:18&codigoseguridad=hhABiM",
  "customerId": "102320705"
}
```

### Campos de la respuesta de consulta

| Campo              | Descripci√≥n                                                         |
| ------------------ | ------------------------------------------------------------------- |
| fileName           | Nombre del archivo XML generado                                     |
| updateAt           | Timestamp de la √∫ltima actualizaci√≥n                                |
| customerReceivedAt | Fecha y hora en que el cliente recibi√≥ el documento                 |
| documentType       | Tipo de documento (ej: "Factura de Cr√©dito Fiscal Electr√≥nico")     |
| customerResponse   | Respuesta completa en formato XML (transformada a JSON para la API) |
| status             | Estado del documento ("Aceptado", "Rechazado", etc.)                |
| dgiiResponse       | Respuestas recibidas de la DGII                                     |
| createdAt          | Timestamp de creaci√≥n del documento                                 |
| securityCode       | C√≥digo de seguridad para la representaci√≥n impresa                  |
| signedXml          | Ruta al documento XML firmado                                       |
| ncf                | N√∫mero de Comprobante Fiscal                                        |
| internalTrackId    | ID de seguimiento interno                                           |
| customerReceived   | Indicador de recepci√≥n por el cliente                               |
| qr_url             | URL del c√≥digo QR para consulta                                     |
| customerId         | ID del cliente (RNC)                                                |

## Consulta de documentos en batch

Para consultar el estado de m√∫ltiples documentos en una sola solicitud, puedes utilizar el endpoint de consulta en batch. Este m√©todo es especialmente √∫til cuando necesitas verificar el estado de varios documentos simult√°neamente, optimizando el rendimiento y reduciendo el n√∫mero de llamadas a la API.

```
POST /{entorno}/documentos-ecf/status/batch
```

### L√≠mites

- **M√°ximo de documentos por consulta**: 100 e-CF por solicitud

### Encabezados requeridos

```
Authorization: Bearer {tu_token}
X-API-KEY: {tu_api_key}
Content-Type: application/json
```

### Cuerpo de la solicitud

El cuerpo de la solicitud debe contener un array con los n√∫meros de comprobantes electr√≥nicos (e-CF) que deseas consultar:

```json
{
  "ecfs": ["E320004380895", "E310000510917", "E310000510916", "E310000510915"]
}
```

<Tabs items={["cURL", "JavaScript", "C#", "PHP"]}>
<TabsContent value="cURL">

### Ejemplo de consulta en batch

```bash
curl -X POST \
  https://ecf.api.mseller.app/TesteCF/documentos-ecf/status/batch \
  -H 'Authorization: Bearer eyJraWQiOiJ1dE...' \
  -H 'X-API-KEY: tu_api_key' \
  -H 'Content-Type: application/json' \
  -d '{
    "ecfs": ["E320004380895", "E310000510917", "E310000510916", "E310000510915"]
  }'
```

</TabsContent>

<TabsContent value="JavaScript">

### Ejemplo de consulta en batch

```javascript
async function consultarDocumentosBatch(ecfs) {
  const idToken = localStorage.getItem("idToken");

  try {
    const response = await fetch(
      `https://ecf.api.mseller.app/TesteCF/documentos-ecf/status/batch`,
      {
        method: "POST",
        headers: {
          Authorization: `Bearer ${idToken}`,
          "X-API-KEY": "tu_api_key",
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ ecfs }),
      }
    );

    const resultado = await response.json();
    console.log("Estado de documentos:", resultado);
    return resultado;
  } catch (error) {
    console.error("Error al consultar documentos en batch:", error);
    throw error;
  }
}

// Uso
const ecfs = [
  "E320004380895",
  "E310000510917",
  "E310000510916",
  "E310000510915",
];
consultarDocumentosBatch(ecfs);
```

</TabsContent>

<TabsContent value="C#">

### Ejemplo de consulta en batch

```csharp
using System;
using System.Collections.Generic;
using System.Net.Http;
using System.Text;
using System.Threading.Tasks;
using Newtonsoft.Json;
using Newtonsoft.Json.Linq;

public class MSellercfClient
{
    private readonly HttpClient _client = new HttpClient();
    private readonly string _idToken;
    private readonly string _apiKey;

    public MSellercfClient(string idToken, string apiKey)
    {
        _idToken = idToken;
        _apiKey = apiKey;
    }

    public async Task<JObject> ConsultarDocumentosBatch(List<string> ecfs)
    {
        _client.DefaultRequestHeaders.Clear();
        _client.DefaultRequestHeaders.Add("Authorization", $"Bearer {_idToken}");
        _client.DefaultRequestHeaders.Add("X-API-KEY", _apiKey);

        var payload = new JObject
        {
            ["ecfs"] = JArray.FromObject(ecfs)
        };

        var content = new StringContent(
            payload.ToString(),
            Encoding.UTF8,
            "application/json");

        var response = await _client.PostAsync(
            "https://ecf.api.mseller.app/TesteCF/documentos-ecf/status/batch",
            content);

        var responseJson = await response.Content.ReadAsStringAsync();
        return JObject.Parse(responseJson);
    }
}

// Uso
var ecfs = new List<string>
{
    "E320004380895",
    "E310000510917",
    "E310000510916",
    "E310000510915"
};
var resultado = await client.ConsultarDocumentosBatch(ecfs);
```

</TabsContent>

<TabsContent value="PHP">

### Ejemplo de consulta en batch

```php
<?php
function consultarDocumentosBatch($ecfs, $idToken, $apiKey) {
    $url = 'https://ecf.api.mseller.app/TesteCF/documentos-ecf/status/batch';

    $payload = json_encode([
        'ecfs' => $ecfs
    ]);

    $options = [
        'http' => [
            'method' => 'POST',
            'header' =>
                "Authorization: Bearer " . $idToken . "\r\n" .
                "X-API-KEY: " . $apiKey . "\r\n" .
                "Content-Type: application/json\r\n",
            'content' => $payload
        ]
    ];

    $context = stream_context_create($options);
    $result = file_get_contents($url, false, $context);

    if ($result === false) {
        // Manejar error
        return null;
    }

    return json_decode($result, true);
}

// Uso
$idToken = $_SESSION['idToken']; // Obtenido del proceso de autenticaci√≥n
$apiKey = 'tu_api_key';
$ecfs = [
    'E320004380895',
    'E310000510917',
    'E310000510916',
    'E310000510915'
];
$resultado = consultarDocumentosBatch($ecfs, $idToken, $apiKey);
print_r($resultado);
?>
```

</TabsContent>
</Tabs>

### Respuesta exitosa

La respuesta incluye el total de documentos consultados y un array con los resultados de cada documento:

```json
{
  "total": 4,
  "results": [
    {
      "ecf": "E320004380895",
      "status": "Aceptado",
      "found": true,
      "data": {
        "buyerRnc": "00115275869",
        "createdAt": 1762217966021,
        "dgiiResponse": [
          "{\"codigo\":1,\"estado\":\"Aceptado\",\"mensajes\":null,\"encf\":\"E320004380895\",\"secuenciaUtilizada\":true}"
        ],
        "documentType": "Factura de Consumo Electr√≥nica",
        "fileName": "102320705E320004380895.xml",
        "internalTrackId": "aada68a0-42c6-4a0a-804a-db9c042e1dc6",
        "invoiceTotal": 385.68,
        "ncf": "E320004380895",
        "qr_url": "https://fc.dgii.gov.do/testecf/consultatimbrefc?rncemisor=102320705&encf=E320004380895&montototal=385.68&codigoseguridad=A7HXQC",
        "secretId": "b14ac74e-ab14-4230-8894-ec19929ed7bc",
        "securityCode": "A7HXQC",
        "signedXml": "102320705/documents/TesteCF/102320705E320004380895.xml",
        "status": "Aceptado",
        "summarySignedXml": "102320705/summaries/TesteCF/102320705E320004380895.xml",
        "updateAt": 1762217969008,
        "customerId": "102320705"
      }
    },
    {
      "ecf": "E310000510917",
      "status": "Aceptado",
      "found": true,
      "data": {
        "buyerRnc": "00115275869",
        "createdAt": 1762215883006,
        "documentType": "Factura de Cr√©dito Fiscal Electr√≥nico",
        "invoiceTotal": 952.28,
        "ncf": "E310000510917",
        "qr_url": "https://ecf.dgii.gov.do/testecf/consultatimbre?rncemisor=102320705&RncComprador=00115275869&encf=E310000510917&fechaemision=04-11-2025&montototal=952.28&fechafirma=03-11-2025%2008%3A24%3A42&codigoseguridad=wKL28p",
        "securityCode": "wKL28p",
        "status": "Aceptado",
        "updateAt": 1762215889088,
        "customerId": "102320705"
      }
    },
    {
      "ecf": "E310000510916",
      "status": "Rechazado",
      "found": true,
      "data": {
        "buyerRnc": "00300717659",
        "createdAt": 1762215563667,
        "dgiiResponse": [
          "{\"trackId\":\"32c4f7e0-dbbe-40cc-a1d4-e4cc0ff82c13\",\"codigo\":\"2\",\"estado\":\"Rechazado\",\"rnc\":\"102320705\",\"encf\":\"E310000510916\",\"secuenciaUtilizada\":true,\"fechaRecepcion\":\"11/3/2025 8:19:30 PM\",\"mensajes\":[{\"valor\":\"El campo MontoGravadoTotal del √°rea Totales de la secci√≥n Encabezado\",\"codigo\":1920}]}"
        ],
        "documentType": "Factura de Cr√©dito Fiscal Electr√≥nico",
        "invoiceTotal": 952.28,
        "ncf": "E310000510916",
        "status": "Rechazado",
        "updateAt": 1762215575268,
        "customerId": "102320705"
      }
    },
    {
      "ecf": "E310000510915",
      "status": "Aceptado Condicional",
      "found": true,
      "data": {
        "buyerRnc": "00115275869",
        "createdAt": 1762215210792,
        "dgiiResponse": [
          "{\"trackId\":\"45309489-f05b-425b-bb67-6706d0a77225\",\"codigo\":\"4\",\"estado\":\"Aceptado Condicional\",\"rnc\":\"102320705\",\"encf\":\"E310000510915\",\"secuenciaUtilizada\":true,\"fechaRecepcion\":\"11/3/2025 8:13:37 PM\",\"mensajes\":[{\"valor\":\"El campo MontoGravadoTotal del √°rea Totales de la secci√≥n Encabezado no corresponde con la sumatoria de los items de su factura ya que excede la tolerancia de 100.\",\"codigo\":1924},{\"valor\":\"El campo MontoTotal del √°rea Totales de la secci√≥n Encabezado no es v√°lido.El elemento MontoTotal no es correcto\",\"codigo\":11105}]}"
        ],
        "documentType": "Factura de Cr√©dito Fiscal Electr√≥nico",
        "invoiceTotal": 952.28,
        "ncf": "E310000510915",
        "status": "Aceptado Condicional",
        "updateAt": 1762215220782,
        "customerId": "102320705"
      }
    }
  ]
}
```

### Campos de la respuesta batch

| Campo   | Descripci√≥n                                           |
| ------- | ----------------------------------------------------- |
| total   | Cantidad total de documentos consultados              |
| results | Array con los resultados de cada documento consultado |

### Campos de cada resultado

| Campo  | Descripci√≥n                                                                                                |
| ------ | ---------------------------------------------------------------------------------------------------------- |
| ecf    | N√∫mero de comprobante electr√≥nico consultado                                                               |
| status | Estado actual del documento ("Aceptado", "Rechazado", "Aceptado Condicional", etc.)                        |
| found  | Indica si el documento fue encontrado en el sistema (true/false)                                           |
| data   | Objeto con los detalles completos del documento (solo si found = true). Ver tabla de campos a continuaci√≥n |

### Campos del objeto data

| Campo              | Descripci√≥n                                                     |
| ------------------ | --------------------------------------------------------------- |
| buyerRnc           | RNC del comprador                                               |
| createdAt          | Timestamp de creaci√≥n del documento                             |
| customerReceived   | Indicador de recepci√≥n por el cliente (opcional)                |
| customerReceivedAt | Fecha y hora en que el cliente recibi√≥ el documento (opcional)  |
| customerResponse   | Respuesta completa en formato XML del comprador (opcional)      |
| dgiiResponse       | Array con las respuestas recibidas de la DGII                   |
| documentType       | Tipo de documento (ej: "Factura de Cr√©dito Fiscal Electr√≥nico") |
| fileName           | Nombre del archivo XML generado                                 |
| internalTrackId    | ID de seguimiento interno                                       |
| invoiceTotal       | Monto total de la factura                                       |
| ncf                | N√∫mero de Comprobante Fiscal                                    |
| qr_url             | URL del c√≥digo QR para consulta                                 |
| secretId           | ID secreto asociado al documento                                |
| securityCode       | C√≥digo de seguridad para la representaci√≥n impresa              |
| signedXml          | Ruta al documento XML firmado                                   |
| summarySignedXml   | Ruta al resumen XML firmado (solo para e-CF tipo 32)            |
| status             | Estado del documento                                            |
| updateAt           | Timestamp de la √∫ltima actualizaci√≥n                            |
| customerId         | ID del cliente (RNC)                                            |

### Ventajas de la consulta en batch

1. **Optimizaci√≥n de rendimiento**: Reduce significativamente el n√∫mero de llamadas HTTP necesarias.
2. **Eficiencia de recursos**: Menor consumo de ancho de banda y mejor gesti√≥n de rate limits.
3. **Sincronizaci√≥n masiva**: Ideal para sincronizar estados de m√∫ltiples documentos de forma peri√≥dica.
4. **Mejor experiencia de usuario**: Respuestas m√°s r√°pidas al consultar m√∫ltiples documentos simult√°neamente.

### Recomendaciones de uso

- **Agrupaci√≥n inteligente**: Agrupa documentos por per√≠odo o proceso para optimizar las consultas.
- **L√≠mite recomendado**: Aunque el m√°ximo es 100, considera usar grupos de 50 documentos para mejor rendimiento.
- **Consultas programadas**: Implementa consultas batch programadas para actualizar estados de forma eficiente.
- **Manejo de errores**: Procesa individualmente los documentos que no fueron encontrados (found = false).
- **Cache local**: Almacena localmente los resultados para evitar consultas repetidas innecesarias.

## Estados de los documentos

Los documentos enviados a la plataforma pueden tener los siguientes estados:

| Estado     | Descripci√≥n                                                          |
| ---------- | -------------------------------------------------------------------- |
| RECIBIDO   | El documento ha sido recibido pero a√∫n no ha sido procesado          |
| PROCESANDO | El documento est√° siendo procesado y validado                        |
| ACEPTADO   | El documento ha sido validado y aceptado correctamente               |
| RECHAZADO  | El documento ha sido rechazado por errores en su formato o contenido |
| ERROR      | Ha ocurrido un error durante el procesamiento del documento          |

## Flujo de procesamiento as√≠ncrono

Es importante entender que MSeller ECF utiliza un procesamiento as√≠ncrono para optimizar el rendimiento y manejar grandes vol√∫menes de documentos. El proceso completo incluye:

1. **Recepci√≥n del documento JSON** - MSeller recibe el documento
2. **Transformaci√≥n a XML** - Conversi√≥n autom√°tica al formato requerido por la DGII
3. **Aplicaci√≥n de firma electr√≥nica** - Utilizando tu certificado digital
4. **Almacenamiento del documento XML** - Guardado seguro de la versi√≥n firmada
5. **Respuesta inmediata** - Devoluci√≥n de c√≥digos de seguridad y enlace QR
6. **Procesamiento en cola** - El documento se coloca en cola para env√≠o a la DGII
7. **Actualizaci√≥n de estado** - El estado del documento se actualiza tras la respuesta de la DGII

**IMPORTANTE**: Debido a este proceso as√≠ncrono, debes esperar unos segundos antes de consultar el estado final del documento para verificar si fue aceptado o rechazado por la DGII.

## Manejo de errores

### Errores comunes en el env√≠o

| C√≥digo HTTP | Descripci√≥n                    | Soluci√≥n                                               |
| ----------- | ------------------------------ | ------------------------------------------------------ |
| 400         | JSON mal formateado            | Verifica que el JSON cumpla con la estructura definida |
| 401         | Error de autenticaci√≥n         | Verifica tu token de acceso                            |
| 403         | API Key inv√°lida               | Verifica tu API Key                                    |
| 429         | L√≠mite de solicitudes excedido | Reduce la frecuencia de solicitudes seg√∫n tu plan      |
| 500         | Error del servidor             | Contacta al soporte t√©cnico                            |

## Buenas pr√°cticas

1. **Validaci√≥n previa con par√°metro validate**: Usa el par√°metro `validate=true` durante el desarrollo para validar tus documentos antes de enviarlos oficialmente. Esto te permite detectar errores sin consumir secuencias de e-NCF.
2. **Manejo de errores**: Implementa un sistema robusto para manejar los diferentes tipos de errores retornados tanto por la validaci√≥n como por la DGII.
3. **Reintentos**: Implementa una estrategia de reintentos para casos de fallos temporales, pero evita reintentar documentos con errores de validaci√≥n.
4. **Almacenamiento local**: Mant√©n una copia local de los documentos enviados para referencia futura.
5. **Consulta peri√≥dica**: Implementa consultas peri√≥dicas para actualizar el estado de los documentos enviados.
6. **Tiempo de espera**: Programa consultas con un tiempo de espera adecuado entre el env√≠o del documento y la consulta de su estado.
7. **Gesti√≥n de c√≥digos de seguridad**: Almacena y gestiona correctamente los c√≥digos de seguridad y URLs de QR para la representaci√≥n impresa de las facturas.
8. **Proceso de dos pasos**: En desarrollo, primero valida con `validate=true` y si es exitoso, env√≠a sin el par√°metro para el registro oficial.

## Recursos y herramientas para la adaptaci√≥n de documentos

Para asegurar que tu integraci√≥n con MSeller ECF funcione correctamente, es fundamental comprender la estructura y los requisitos espec√≠ficos de los documentos electr√≥nicos. La Direcci√≥n General de Impuestos Internos (DGII) ofrece recursos oficiales que te ayudar√°n en este proceso.

### Documentaci√≥n y archivos XSD oficiales

La DGII proporciona documentaci√≥n detallada y archivos XSD (XML Schema Definition) que contienen la definici√≥n completa de la estructura de los documentos electr√≥nicos. Estos recursos son esenciales para comprender los campos requeridos y las validaciones que se aplican a cada tipo de documento.

#### Formatos XML

| Archivo                                                                                                                                                                                                                                                     | Descripci√≥n                                                                                        | √öltima modificaci√≥n | Tama√±o  |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------- | ------------------- | ------- |
| [Formato Comprobante Fiscal Electr√≥nico (e-CF) V 1.0](<https://dgii.gov.do/cicloContribuyente/facturacion/comprobantesFiscalesElectronicosE-CF/Documentacin%20sobre%20eCF/Formatos%20XML/Formato%20Comprobante%20Fiscal%20Electr√≥nico%20(e-CF)%20V1.0.pdf>) | Especificaciones para la elaboraci√≥n de un e-CF                                                    | 18/09/2024          | 2,1MB   |
| [Formato Acuse de Recibo v1.0](https://dgii.gov.do/cicloContribuyente/facturacion/comprobantesFiscalesElectronicosE-CF/Documentacin%20sobre%20eCF/Formatos%20XML/Formato%20Acuse%20de%20Recibo%20v%201.0.pdf)                                               | Especificaciones para recibir y dar constancia de recibo de un e-CF                                | 23/07/2020          | 193,2KB |
| [Formato Aprobaci√≥n Comercial V1.0](https://dgii.gov.do/cicloContribuyente/facturacion/comprobantesFiscalesElectronicosE-CF/Documentacin%20sobre%20eCF/Formatos%20XML/Formato%20Aprobaci√≥n%20Comercial%20v1.0.pdf)                                          | Especificaciones para recibir y dar respuesta de la conformidad de un e-CF                         | 10/01/2020          | 212,2KB |
| [Formato Anulaci√≥n de e-CF V1.0](https://dgii.gov.do/cicloContribuyente/facturacion/comprobantesFiscalesElectronicosE-CF/Documentacin%20sobre%20eCF/Formatos%20XML/Formato%20Anulaci√≥n%20de%20e-NCF%20v1.0.pdf)                                             | Especificaciones para la Anulaci√≥n de un e-CF                                                      | 20/06/2022          | 494,4KB |
| [Formato Resumen Factura Consumo Electr√≥nico v1.0](https://dgii.gov.do/cicloContribuyente/facturacion/comprobantesFiscalesElectronicosE-CF/Documentacin%20sobre%20eCF/Formatos%20XML/Formato%20Resumen%20Factura%20Consumo%20Electr√≥nica%20v1.0.pdf)        | Especificaciones para la remisi√≥n del resumen de factura de consumo electr√≥nica menor a DOP250 mil | 19/08/2020          | 275KB   |

#### Documentaci√≥n T√©cnica (XSD)

| Archivo                                                                                                                                                                                     | Descripci√≥n                                      | √öltima modificaci√≥n | Tama√±o  |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------ | ------------------- | ------- |
| [e-CF 31 v.1.0](<https://dgii.gov.do/cicloContribuyente/facturacion/comprobantesFiscalesElectronicosE-CF/Documentacin%20sobre%20eCF/Documentaci√≥n%20T√©cnica%20(XSD)/e-CF%2031%20v.1.0.xsd>) | Factura de Cr√©dito Fiscal Electr√≥nica            | 13/02/2025          | 120,1KB |
| [e-CF 32 v.1.0](<https://dgii.gov.do/cicloContribuyente/facturacion/comprobantesFiscalesElectronicosE-CF/Documentacin%20sobre%20eCF/Documentaci√≥n%20T√©cnica%20(XSD)/e-CF%2032%20v.1.0.xsd>) | Factura de Consumo Electr√≥nica                   | 13/02/2025          | 120,1KB |
| [e-CF 33 v.1.0](<https://dgii.gov.do/cicloContribuyente/facturacion/comprobantesFiscalesElectronicosE-CF/Documentacin%20sobre%20eCF/Documentaci√≥n%20T√©cnica%20(XSD)/e-CF%2033%20v.1.0.xsd>) | Nota de D√©bito Electr√≥nica                       | 13/02/2025          | 121,5KB |
| [e-CF 34 v.1.0](<https://dgii.gov.do/cicloContribuyente/facturacion/comprobantesFiscalesElectronicosE-CF/Documentacin%20sobre%20eCF/Documentaci√≥n%20T√©cnica%20(XSD)/e-CF%2034%20v.1.0.xsd>) | Nota de Cr√©dito Electr√≥nica                      | 13/02/2025          | 119,1KB |
| [e-CF 41 v.1.0](<https://dgii.gov.do/cicloContribuyente/facturacion/comprobantesFiscalesElectronicosE-CF/Documentacin%20sobre%20eCF/Documentaci√≥n%20T√©cnica%20(XSD)/e-CF%2041%20v.1.0.xsd>) | Comprobante de Compras Electr√≥nico               | 13/02/2025          | 108,5KB |
| [e-CF 43 v.1.0](<https://dgii.gov.do/cicloContribuyente/facturacion/comprobantesFiscalesElectronicosE-CF/Documentacin%20sobre%20eCF/Documentaci√≥n%20T√©cnica%20(XSD)/e-CF%2043%20v.1.0.xsd>) | Comprobante de Gastos Menores Electr√≥nico        | 13/02/2025          | 93,8KB  |
| [e-CF 44 v.1.0](<https://dgii.gov.do/cicloContribuyente/facturacion/comprobantesFiscalesElectronicosE-CF/Documentacin%20sobre%20eCF/Documentaci√≥n%20T√©cnica%20(XSD)/e-CF%2044%20v.1.0.xsd>) | Comprobante de Reg√≠menes Especiales Electr√≥nico  | 13/02/2025          | 111,6KB |
| [e-CF 45 v.1.0](<https://dgii.gov.do/cicloContribuyente/facturacion/comprobantesFiscalesElectronicosE-CF/Documentacin%20sobre%20eCF/Documentaci√≥n%20T√©cnica%20(XSD)/e-CF%2045%20v.1.0.xsd>) | Comprobante Gubernamental Electr√≥nico            | 13/02/2025          | 118,9KB |
| [e-CF 46 v.1.0](<https://dgii.gov.do/cicloContribuyente/facturacion/comprobantesFiscalesElectronicosE-CF/Documentacin%20sobre%20eCF/Documentaci√≥n%20T√©cnica%20(XSD)/e-CF%2046%20v.1.0.xsd>) | Comprobante para Pagos al Exterior Electr√≥nico   | 13/02/2025          | 113,2KB |
| [e-CF 47 v.1.0](<https://dgii.gov.do/cicloContribuyente/facturacion/comprobantesFiscalesElectronicosE-CF/Documentacin%20sobre%20eCF/Documentaci√≥n%20T√©cnica%20(XSD)/e-CF%2047%20v.1.0.xsd>) | Comprobante de Ingresos Electr√≥nico              | 13/02/2025          | 98,9KB  |
| [RFCE 32 v1.0](<https://dgii.gov.do/cicloContribuyente/facturacion/comprobantesFiscalesElectronicosE-CF/Documentacin%20sobre%20eCF/Documentaci√≥n%20T√©cnica%20(XSD)/RFCE%2032%20v.1.0.xsd>)  | Representaci√≥n Fiscal de Comprobante Electr√≥nico | 20/06/2023          | 15KB    |
| [ARECF v1.0](<https://dgii.gov.do/cicloContribuyente/facturacion/comprobantesFiscalesElectronicosE-CF/Documentacin%20sobre%20eCF/Documentaci√≥n%20T√©cnica%20(XSD)/ARECF%20v1.0.xsd>)         | Acuse de Recibo de e-CF                          | 20/06/2023          | 2,8KB   |
| [ANECF v.1.0](<https://dgii.gov.do/cicloContribuyente/facturacion/comprobantesFiscalesElectronicosE-CF/Documentacin%20sobre%20eCF/Documentaci√≥n%20T√©cnica%20(XSD)/ANECF%20v.1.0.xsd>)       | Acuse Negativo de Recibo de e-CF                 | 20/06/2023          | 5KB     |
| [ACECF v.1.0](<https://dgii.gov.do/cicloContribuyente/facturacion/comprobantesFiscalesElectronicosE-CF/Documentacin%20sobre%20eCF/Documentaci√≥n%20T√©cnica%20(XSD)/ACECF%20v.1.0.xsd>)       | Acuse Comercial de e-CF                          | 21/12/2022          | 3,5KB   |
| [Semilla v.1.0](<https://dgii.gov.do/cicloContribuyente/facturacion/comprobantesFiscalesElectronicosE-CF/Documentacin%20sobre%20eCF/Documentaci√≥n%20T√©cnica%20(XSD)/Semilla%20v.1.0.xsd>)   | Definici√≥n de semilla para firma                 | 12/11/2020          | 487B    |

> **Nota:** Los archivos XSD se pueden abrir con Visual Studio en Windows para visualizar la estructura completa de los esquemas XML.

### Herramientas para validaci√≥n y depuraci√≥n

Para facilitar la adaptaci√≥n de tus sistemas a los requisitos de documentos electr√≥nicos, puedes utilizar las siguientes herramientas:

#### Convertidores y validadores online

- **JSON a XML**: Para comprobar la conversi√≥n correcta entre el formato JSON que utilizas en las solicitudes y el formato XML que se utiliza internamente.

  - [https://jsonformatter.org/xml-formatter](https://jsonformatter.org/xml-formatter)
  - [https://www.freeformatter.com/json-to-xml-converter.html](https://www.freeformatter.com/json-to-xml-converter.html)

- **Validadores XSD**: Para verificar que tus documentos XML cumplen con los esquemas definidos por la DGII.
  - [https://www.freeformatter.com/xml-validator-xsd.html](https://www.freeformatter.com/xml-validator-xsd.html)
  - [https://www.liquid-technologies.com/online-xsd-validator](https://www.liquid-technologies.com/online-xsd-validator)

#### Simuladores de entorno

MSeller ECF ofrece un ambiente de prueba (TesteCF) que te permite validar tus documentos antes de usarlos en producci√≥n. Este entorno simula completamente el proceso de env√≠o y recepci√≥n de documentos electr√≥nicos.

Para usar el simulador:

1. Env√≠a tus documentos al endpoint `TesteCF` como se describe en la secci√≥n de [Env√≠o de documentos](#env√≠o-de-documentos)
2. Utiliza secuencias de prueba para los eNCF (como se indica en la nota sobre secuencias aleatorias)
3. Verifica las respuestas y corrija cualquier error antes de pasar a producci√≥n

### Soporte y asesor√≠a

Si encuentras dificultades durante la implementaci√≥n o adaptaci√≥n de tus documentos, puedes recurrir a:

- **Soporte t√©cnico de MSeller**: A trav√©s del [portal de soporte](https://support.mseller.app)
- **Documentaci√≥n extendida**: Disponible en el [Centro de Ayuda de MSeller](https://help.mseller.app)
- **Asesor√≠a especializada**: MSeller ofrece servicios de consultor√≠a para casos complejos de integraci√≥n
